rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // ðŸ”’ LICENSES: Absolutely no direct client access
    // Only server-side Cloud Functions can access licenses
    match /licenses/{licenseId} {
      allow read, write: if false;
    }

    // ðŸ”’ EMAIL QUEUE: Server-only (Firebase Extensions + Admin SDK)
    // Used by email extension and webhook functions
    match /mail/{docId} {
      allow read, write: if false;
    }

    // ðŸ”’ PAYMENTS: Server-only access for webhook processing
    // Stripe webhook data should not be accessible to clients  
    match /payments/{paymentId} {
      allow read, write: if false;
    }

    // ðŸ“‚ PUBLIC DATA: Read-only for all users
    // Use this for app configuration, feature flags, etc.
    match /public/{docId} {
      allow read: if true;
      allow write: if false; // Only admins via server
    }

    // ðŸ‘¤ USER DATA: Authenticated users can read/write their own data
    // Future: when you add user authentication
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // ðŸš« DEFAULT DENY: Block all other access
    // This ensures we explicitly allow what we want
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
